:purple_heart: for [#rstats](https://twitter.com/search?q=%23rstats), my [favorite editor](https://neovim.io/) and a nice [completion framework](https://github.com/roxma/nvim-completion-manager)

# Asynchronous R completion for Neovim

![Gif screenshot](https://user-images.githubusercontent.com/6551953/33690893-e896c35e-dae5-11e7-973d-cc1bffed1fcf.gif)

ncm-R extends the
[nvim-completion-manager](https://github.com/roxma/nvim-completion-manager)
(NCM) framework to provide asynchronous completion for the R language. It relies on the great plugin
[nvim-R](https://github.com/jalvesaq/Nvim-R) to get the completion data.

**Table of contents:**
<!-- vim-markdown-toc GFM -->

* [Features](#features)
* [Who should use this plugin?](#who-should-use-this-plugin)
* [Installation](#installation)
* [How to use ncm-R](#how-to-use-ncm-r)
* [How ncm-R works](#how-ncm-r-works)

<!-- vim-markdown-toc -->

## Features

+ Completion support for:
    + **objects** from the global R environment
    + **functions** from all currently loaded packages or from precise package
        with `package::`
    + **packages** inside `library()` and `require()`
    + **datasets** inside `data()`
    + **arguments** inside functions
    + **variables inside data transformation pipelines** (`%>%`) **and building
        ggplots** (`+`)
+ **expand syntax snippets** when pressing Tab (if [UltiSnips](https://github.com/sirver/UltiSnips)
    is installed):
    + `dataframe` -> `dataframe %>%`
    + `function` -> `function(arg1, arg2, ...)` (expands mandatory arguments
        only)
    + `package` -> `package::`
    + `argument` -> `argument = DEFAULT_VALUE`

## Who should use this plugin?

You'll probably enjoy ncm-R:

+ If you like how [RStudio](https://rstudio.com) does completion but won't use
any editor other than Neovim
+ If you use a lot of data pipelines (`%>%`)
+ If you want a "suggest as you type" completion behavior

It should be noted that [Nvim-R](https://github.com/jalvesaq/Nvim-R) already
comes with OmniCompletion. It's lightweight and it works well, but you need to
ask for completion (`<C-x><C-o>`, `<C-x><C-a>` for arguments) and it
doesn't support pipelines.

## Installation

Use your favorite plugin manager. For instance, with
[vim-plug](https://github.com/junegunn/vim-plug) :

```vim
Plug 'roxma/nvim-completion-manager'
Plug 'jalvesaq/Nvim-R', { 'for' : 'r' }
Plug 'gaalcaras/ncm-R'

" Optional: for snippet support
Plug 'sirver/UltiSnips'
```

## How to use ncm-R

When you open an R file, **first start an R session** with nvim-R (default
mapping is `<localleader>rf`, see `:help Nvim-R-use`).  That's because
completion suggestions only include objects from your global environment and
functions from loaded packages (although Nvim-R loads some packages by default,
see `:help R_start_libs`).

If you're familiar with completion in [RStudio](https://rstudio.com),
you will feel at home with ncm-R. For instance, you won't see suggestions for
your `data.frames` and their variables before you load them in the R console.
Likewise, you won't see `dplyr` functions if you forgot to run `library(dplyr)`
first.

**When you load a package for the first time in nvim-R, ncm-R will not provide
completion for it right away**. You will need to restart Neovim to benefit from
the suggestions of the newly loaded package. That means that if you've never
used nvim-R before, you may need to load some packages first, including
`library(utils)`, then restart Neovim. If you want to know why this is
necessary, you're welcome to read [this section](#how-ncm-r-works) of the
README.

## How ncm-R works

When ncm-R is loaded by NCM as a source for the R language, it retrieves all
the omni completion data generated by Nvim-R in the `g:rplugin_compldir`
directory.

When you load a package for the first time in Nvim-R, it creates files with the
completion data of the package in this directory. To avoid constantly reading
files on disk, ncm-R loads the data from these files only once. That's why
ncm-R won't display suggestions for packages that were loaded for the first
time after NCM has been started.

Then ncm-R keeps track of:

+ objects in the `.GlobalEnv` using the
`GlobalEnvList_*` file generated by Nvim-R, located in the `g:rplugin_tmpdir`
directory
+ loaded packages using a temporary `loaded_pkgs_` file, generated through  nvimcom
