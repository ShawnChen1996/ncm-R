:purple_heart: for [#rstats](https://twitter.com/search?q=%23rstats), my [favorite editor](https://neovim.io/) and a nice [completion framework](https://github.com/roxma/nvim-completion-manager)

# Asynchronous R completion for Neovim

![fullscreen screencast](https://user-images.githubusercontent.com/6551953/33690893-e896c35e-dae5-11e7-973d-cc1bffed1fcf.gif)

ncm-R extends the
[nvim-completion-manager](https://github.com/roxma/nvim-completion-manager)
(NCM) framework to provide asynchronous completion for the R language. It relies on the great plugin
[nvim-R](https://github.com/jalvesaq/Nvim-R) to get the completion data.

**Table of contents:**
<!-- vim-markdown-toc GFM -->

* [Features](#features)
	* [Completion](#completion)
	* [Snippets](#snippets)
* [Who should use this plugin?](#who-should-use-this-plugin)
* [Installation](#installation)
* [How to use ncm-R](#how-to-use-ncm-r)
* [How ncm-R works](#how-ncm-r-works)

<!-- vim-markdown-toc -->

## Features

### Completion

**Objects** from the global R environment :

![variables](https://user-images.githubusercontent.com/6551953/33718172-ce45f746-db5c-11e7-878f-818f5a7059b3.gif)

**Functions** from all currently loaded packages or from precise package with `package::`:

![functions](https://user-images.githubusercontent.com/6551953/33718180-d4510ff4-db5c-11e7-9536-8e8b52f9630f.gif)

**Packages** inside `library()` and `require()`:

![library](https://user-images.githubusercontent.com/6551953/33718181-d47e22dc-db5c-11e7-9768-385b1c1558fe.gif)

**Datasets** inside `data()`:

![data](https://user-images.githubusercontent.com/6551953/33718183-d49b9f06-db5c-11e7-8c97-a5a1793907a3.gif)

**Arguments** inside functions:

![arguments](https://user-images.githubusercontent.com/6551953/33718185-d4b86816-db5c-11e7-8db8-28df7a95d456.gif)

**Variables inside data transformation pipelines** (`%>%`) **and building ggplots** (`+`):

![pipeline](https://user-images.githubusercontent.com/6551953/33718382-76ee990c-db5d-11e7-9a84-89e790c9e577.gif)

### Snippets

If [UltiSnips](https://github.com/sirver/UltiSnips) is installed, pressing Tab
after selecting a completion suggestion will **expand syntax snippets**:

+ `dataframe` -> `dataframe %>%`
+ `function` -> `function(arg1, arg2, ...)` (expands mandatory arguments only)
+ `package` -> `package::`
+ `argument` -> `argument = DEFAULT_VALUE`

## Who should use this plugin?

You'll probably enjoy ncm-R:

+ If you like how [RStudio](https://rstudio.com) does completion but won't use
any editor other than Neovim
+ If you use a lot of data pipelines (`%>%`)
+ If you want a "suggest as you type" completion behavior

It should be noted that [Nvim-R](https://github.com/jalvesaq/Nvim-R) already
comes with OmniCompletion. It's lightweight and it works well, but you need to
ask for completion (`<C-x><C-o>`, `<C-x><C-a>` for arguments) and it
doesn't support pipelines.

On the other hand, ncm-R offers more features, but it's not as lightweight,
especially since R exposes so many functions to the user − which is why I find
"suggest as you type" completion so useful in the first place. That being said,
ncm-R has been pretty fast for me so far, even when running on a 2011 laptop.

## Installation

Use your favorite plugin manager. For instance, with
[vim-plug](https://github.com/junegunn/vim-plug) :

```vim
Plug 'roxma/nvim-completion-manager'
Plug 'jalvesaq/Nvim-R', { 'for' : 'r' }
Plug 'gaalcaras/ncm-R'

" Optional: for snippet support
Plug 'sirver/UltiSnips'
```

## How to use ncm-R

When you open an R file, **first start an R session** with nvim-R (default
mapping is `<localleader>rf`, see `:help Nvim-R-use`).  That's because
completion suggestions only include objects from your global environment and
functions from loaded packages (although Nvim-R loads some packages by default,
see `:help R_start_libs`).

If you're familiar with completion in [RStudio](https://rstudio.com),
you will feel at home with ncm-R. For instance, you won't see suggestions for
your `data.frames` and their variables before you run the proper command in the
R console to load them in the global environment.  Likewise, you won't see
`dplyr` functions if you forgot to run `library(dplyr)` first.

## How ncm-R works

When ncm-R is loaded by NCM as a source for the R language, it retrieves all
the omni completion data generated by Nvim-R in the `g:rplugin_compldir`
directory.

Then ncm-R keeps track of:

+ objects in the `.GlobalEnv` using the
`GlobalEnvList_*` file generated by Nvim-R, located in the `g:rplugin_tmpdir`
directory
+ loaded packages using a temporary `loaded_pkgs_` file, generated through
  nvimcom. If you load a package for the first time in Nvim-R, ncm-R updates
  the completion data with the new omni file in `g:rplugin_compldir`

For more information, please check out [this section of Nvim-R's
README](https://github.com/jalvesaq/Nvim-R#the-communication-between-r-and-either-vim-or-neovim)
and `:help NCM-API` for details about NCM's API.
